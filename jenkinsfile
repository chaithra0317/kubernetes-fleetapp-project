pipeline {

agent none
environment {     
   releaseName='fleetapp'
   }


stages {
  stage('Git checkout') {	
  agent {label 'docker'}
    steps {
      checkout scmGit(branches: [[name: '*/main']], extensions: [], userRemoteConfigs: [[url: 'https://github.com/chaithra0317/kubernetes-fleetapp-project.git']])
    }
  }

  stage('build') {	
  agent {label 'docker'}
    steps {
      sh 'docker build -t richardchesterwood/k8s-fleetman-queue:release2 . ' #queue
	  sh 'docker build -t richardchesterwood/k8s-fleetman-position-simulator:release2 . ' #position-simulator
	  sh 'docker build -t richardchesterwood/k8s-fleetman-position-tracker:release2 . ' #position-tracker
	  sh 'docker build -t richardchesterwood/k8s-fleetman-api-gateway:release2 . ' #api-gateway
	  sh 'docker build -t richardchesterwood/k8s-fleetman-webapp-angular:release2 . ' #webapp-angular
    }
  }
 
   stage('deploying on kubernetes') {	
   agent {label 'k8s'}
    steps {
      sh "helm upgrade --install ${releaseName} /home/ubuntu/helm"
    }
  }
}
}